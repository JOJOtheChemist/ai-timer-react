# 动态广场页（MomentsPage）业务域-文件映射表

| 动态广场页核心功能                 | 对应业务域 | 后端文件路径                                   | 核心函数/接口说明                                                                                                                                                                                                                                                                                                                        |
| ---------------------------------- | ---------- | ---------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 1. 动态/干货内容展示（分类切换）   | moment     | api/v1/endpoints/moment/moments.py             | - GET /api/v1/moments：获取内容列表（支持type参数：dynamic/dryGoods，默认dynamic）`<br>`- 支持分页参数（page、page_size）                                                                                                                                                                                                              |
|                                    | moment     | services/moment/moment_service.py              | - get_moment_list(moment_type, page, page_size)：按类型查询内容列表（动态/干货），包含置顶广告`<br>`- 自动拼接用户基础信息（头像、名称）                                                                                                                                                                                               |
|                                    | moment     | crud/moment/crud_moment.py                     | - get_multi_by_type(db, moment_type, page, page_size)：按类型从数据库查询内容`<br>`- get_top_ad(db)：查询置顶广告内容                                                                                                                                                                                                                  |
|                                    | moment     | models/schemas/moment.py                       | - MomentListResponse：内容列表响应模型（区分动态/干货，含user、content、tags、stats等）`<br>`- MomentTypeEnum：枚举动态（dynamic）/干货（dryGoods）                                                                                                                                                                                    |
| 2. 内容发布（动态/干货）           | moment     | api/v1/endpoints/moment/moments.py             | - POST /api/v1/moments：发布内容（支持type参数区分动态/干货，请求体含对应字段）`<br>`- 动态发布：需content、tags等；干货发布：额外需title、attachments等                                                                                                                                                                               |
|                                    | moment     | services/moment/moment_service.py              | - create_dynamic(user_id, dynamic_data)：发布动态（校验内容长度、标签格式）`<br>`- create_dry_goods(user_id, dry_goods_data)：发布干货（校验标题、附件关联合法性）                                                                                                                                                                     |
|                                    | moment     | crud/moment/crud_moment.py                     | - create(db, user_id, moment_data)：保存内容到数据库（自动填充发布时间、用户ID）`<br>`- save_attachments(db, moment_id, attachments)：保存干货的附件关联（如时间表ID、文件ID）                                                                                                                                                         |
|                                    | moment     | models/schemas/moment.py                       | - DynamicCreate：动态发布请求模型（content、tags等）`<br>`- DryGoodsCreate：干货发布请求模型（title、content、tags、attachments等）                                                                                                                                                                                                    |
| 3. 搜索功能（按标签/内容/用户）    | moment     | api/v1/endpoints/moment/moments.py             | - GET /api/v1/moments/search：按关键词搜索内容（支持keyword参数，匹配title、content、tags、user_name）                                                                                                                                                                                                                                   |
|                                    | moment     | services/moment/moment_service.py              | - search_moments(keyword, page, page_size)：处理搜索逻辑（多字段模糊匹配，去重）                                                                                                                                                                                                                                                         |
|                                    | moment     | crud/moment/crud_moment.py                     | - search_by_keyword(db, keyword, page, page_size)：执行数据库模糊查询（关联用户表匹配用户名）                                                                                                                                                                                                                                            |
| 4. 筛选功能（标签/时间/热度）      | moment     | api/v1/endpoints/moment/moments.py             | - 复用GET /api/v1/moments接口，通过query参数传递筛选条件（tags、time_range、hot_type）                                                                                                                                                                                                                                                   |
|                                    | moment     | services/moment/moment_service.py              | - parse_filter_params(filter_params)：解析筛选参数（如time_range转换为数据库时间条件，hot_type转换为排序规则）`<br>`- get_filtered_moments(moment_type, filters, page, page_size)：按筛选条件查询内容                                                                                                                                  |
|                                    | moment     | crud/moment/crud_moment.py                     | - get_multi_by_filters(db, moment_type, filters, page, page_size)：按筛选条件执行数据库查询（标签匹配、时间范围、热度排序）                                                                                                                                                                                                              |
|                                    | moment     | models/schemas/moment.py                       | - MomentFilterParams：筛选参数请求模型（tags列表、time_range、hot_type等）                                                                                                                                                                                                                                                               |
| 5. 互动功能（点赞/评论/分享/收藏） | moment     | api/v1/endpoints/moment/moment_interactions.py | - POST /api/v1/moments/{moment_id}/like：点赞/取消点赞`<br>`- GET /api/v1/moments/{moment_id}/comments：获取评论列表`<br>`- POST /api/v1/moments/{moment_id}/comments：提交评论`<br>`- POST /api/v1/moments/{moment_id}/share：记录分享行为`<br>`- POST /api/v1/moments/{moment_id}/bookmark：收藏/取消收藏                      |
|                                    | moment     | services/moment/moment_interaction_service.py  | - toggle_like(user_id, moment_id)：切换点赞状态（检查是否已点赞，避免重复）`<br>`- get_comments(moment_id, page)：获取评论列表`<br>`- create_comment(user_id, moment_id, comment_content)：提交评论`<br>`- record_share(user_id, moment_id)：记录分享行为（不重复计数）`<br>`- toggle_bookmark(user_id, moment_id)：切换收藏状态 |
|                                    | moment     | crud/moment/crud_moment_interaction.py         | - toggle_like(db, user_id, moment_id)：更新点赞状态（含唯一约束：user_id+moment_id）`<br>`- get_comments_by_moment(db, moment_id, page)：按动态ID查评论`<br>`- create_comment(db, user_id, moment_id, content)：保存评论`<br>`- toggle_bookmark(db, user_id, moment_id)：更新收藏状态                                              |
|                                    | moment     | models/schemas/moment.py                       | - InteractionResponse：互动操作响应模型（含当前状态：is_liked/is_bookmarked等）`<br>`- CommentCreate：评论请求模型（content字段）                                                                                                                                                                                                      |

### 说明

1. **业务域核心**：所有与“用户动态/干货内容”相关的功能（展示、发布、互动）均归为 `moment`业务域，避免分散到其他业务域导致逻辑混乱；广告内容作为“特殊动态”，在 `moment`服务中单独处理（置顶优先级），无需新增独立业务域。
2. **互动逻辑设计**：点赞/收藏需处理“去重”（同一用户对同一内容只能操作一次），通过 `crud`层添加 `user_id+moment_id`唯一约束实现；分享功能仅记录行为（不涉及状态切换），无需去重。
3. **跨域关联处理**：干货发布时关联的“时间表/学习方法”，仅在 `moment`的数据库中存储关联ID（如 `schedule_id`），不存储具体内容；前端展示时需单独调用 `schedule`/`method`业务域的接口获取详情，`moment`服务不处理跨域数据的具体逻辑。
4. **分页与性能**：所有内容列表接口均支持分页（默认page=1，page_size=10），`service`层通过 `crud`层的分页查询减少数据传输量，提升前端加载速度。

如果需要继续分析下一个页面，直接提供对应的React文件即可～
