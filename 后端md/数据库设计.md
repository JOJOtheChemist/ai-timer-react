# 基于10个页面的数据库结构设计（总览版）

数据库设计核心原则：**按业务域分表、外键关联保证数据一致性、冗余字段最小化**，以下是覆盖所有页面功能的核心表结构，每个表标注关键字段、类型及关联关系，你可基于此细化字段长度、索引等细节。

## 一、用户核心域（支撑个人主页、登录、权限）

| 表名                     | 字段名            | 类型                                     | 备注（关联关系/核心功能）                  |
| ------------------------ | ----------------- | ---------------------------------------- | ------------------------------------------ |
| `user`                 | id                | BIGINT                                   | 主键（用户唯一标识）                       |
|                          | username          | VARCHAR(50)                              | 用户名（如“考研的小艾”）                 |
|                          | avatar            | VARCHAR(255)                             | 头像URL（或 emoji 标识）                   |
|                          | phone             | VARCHAR(20)                              | 手机号（唯一，用于登录）                   |
|                          | password_hash     | VARCHAR(255)                             | 密码哈希（不存明文）                       |
|                          | goal              | VARCHAR(100)                             | 目标（如“24考研上岸会计学”）             |
|                          | major             | VARCHAR(50)                              | 专业（如“财务管理”）                     |
|                          | join_time         | DATETIME                                 | 加入日期（如“2024-03-15”）               |
|                          | status            | TINYINT                                  | 账号状态（0-正常，1-禁用）                 |
| `user_asset`           | id                | BIGINT                                   | 主键                                       |
|                          | user_id           | BIGINT                                   | 外键（关联 `user.id`）                   |
|                          | diamond_count     | INT                                      | 钻石数量（如158）                          |
|                          | last_consume_time | DATETIME                                 | 最近消费时间                               |
| `user_profile`         | id                | BIGINT                                   | 主键                                       |
|                          | user_id           | BIGINT                                   | 外键（关联 `user.id`，一对一）           |
|                          | real_name         | VARCHAR(50)                              | 真实姓名（可选）                           |
|                          | bio               | TEXT                                     | 个人简介                                   |
|                          | total_study_hours | DECIMAL(10,1)                            | 总学习时长（如1286.5h，关联统计数据）      |
| `user_message_setting` | id                | BIGINT                                   | 主键                                       |
|                          | user_id           | BIGINT                                   | 外键（关联 `user.id`，一对一）           |
|                          | reminder_type     | TINYINT                                  | 提醒方式（0-仅APP内，1-推送通知）          |
|                          | keep_days         | INT                                      | 未读消息保留天数（如7）                    |
| `user_relation`        | id                | BIGINT                                   | 主键                                       |
|                          | user_id           | BIGINT                                   | 外键（关联 `user.id`，关注方）           |
|                          | target_user_id    | BIGINT                                   | 外键（关联 `user.id`，被关注方）         |
|                          | relation_type     | TINYINT                                  | 关系类型（0-关注导师，1-粉丝，2-普通好友） |
|                          | create_time       | DATETIME                                 | 建立时间                                   |
|                          | UNIQUE KEY        | (user_id, target_user_id, relation_type) | 避免重复关注                               |

## 二、任务与时间表域（支撑首页核心功能）

| 表名            | 字段名            | 类型         | 备注（关联关系/核心功能）                                                |
| --------------- | ----------------- | ------------ | ------------------------------------------------------------------------ |
| `task`        | id                | BIGINT       | 主键                                                                     |
|                 | user_id           | BIGINT       | 外键（关联 `user.id`）                                                 |
|                 | name              | VARCHAR(100) | 任务名（如“考研复习”）                                                 |
|                 | type              | VARCHAR(20)  | 任务类型（study-学习，life-生活，work-工作）                             |
|                 | category          | VARCHAR(20)  | 分类（如“学习”）                                                       |
|                 | weekly_hours      | DECIMAL(5,1) | 本周时长（如8.5h）                                                       |
|                 | is_high_frequency | TINYINT      | 是否高频（0-否，1-是）                                                   |
|                 | is_overcome       | TINYINT      | 是否待克服（0-否，1-是）                                                 |
|                 | create_time       | DATETIME     | 创建时间                                                                 |
|                 | update_time       | DATETIME     | 更新时间                                                                 |
| `subtask`     | id                | BIGINT       | 主键                                                                     |
|                 | task_id           | BIGINT       | 外键（关联 `task.id`，一对多）                                         |
|                 | user_id           | BIGINT       | 外键（关联 `user.id`，冗余字段便于查询）                               |
|                 | name              | VARCHAR(100) | 子任务名（如“英语阅读训练”）                                           |
|                 | hours             | DECIMAL(5,1) | 时长（如3h）                                                             |
|                 | is_high_frequency | TINYINT      | 是否高频（0-否，1-是）                                                   |
|                 | is_overcome       | TINYINT      | 是否待克服（0-否，1-是）                                                 |
| `time_slot`   | id                | BIGINT       | 主键                                                                     |
|                 | user_id           | BIGINT       | 外键（关联 `user.id`）                                                 |
|                 | date              | DATE         | 日期（如“2025-09-19”）                                                 |
|                 | time_range        | VARCHAR(20)  | 时段（如“07:30-08:30”）                                                |
|                 | task_id           | BIGINT       | 外键（关联 `task.id`，可空-空白时段）                                  |
|                 | subtask_id        | BIGINT       | 外键（关联 `subtask.id`，可空）                                        |
|                 | status            | VARCHAR(20)  | 状态（completed-已完成，in-progress-进行中，pending-未开始，empty-空白） |
|                 | is_ai_recommended | TINYINT      | 是否AI推荐（0-否，1-是）                                                 |
|                 | note              | TEXT         | 备注（如“完成微积分前3章公式背诵”）                                    |
|                 | ai_tip            | TEXT         | AI提示（如“每篇阅读控制在18分钟内”）                                   |
| `mood_record` | id                | BIGINT       | 主键                                                                     |
|                 | user_id           | BIGINT       | 外键（关联 `user.id`）                                                 |
|                 | time_slot_id      | BIGINT       | 外键（关联 `time_slot.id`，一对一）                                    |
|                 | mood              | VARCHAR(20)  | 心情（happy-愉快，focused-专注，tired-疲惫）                             |
|                 | create_time       | DATETIME     | 记录时间                                                                 |

## 三、学习方法与打卡域（支撑学习方法页）

| 表名               | 字段名        | 类型                                     | 备注（关联关系/核心功能）                           |
| ------------------ | ------------- | ---------------------------------------- | --------------------------------------------------- |
| `study_method`   | id            | BIGINT                                   | 主键                                                |
|                    | name          | VARCHAR(100)                             | 方法名（如“艾宾浩斯复习四步法”）                  |
|                    | category      | VARCHAR(20)                              | 分类（common-通用方法，tutor-导师独创）             |
|                    | type          | VARCHAR(20)                              | 适用类型（如“全学科”“文科背诵”）                |
|                    | description   | TEXT                                     | 方法描述                                            |
|                    | steps         | TEXT                                     | 步骤（JSON格式存储数组，如["步骤1...","步骤2..."]） |
|                    | scene         | VARCHAR(200)                             | 推荐场景（如“背单词、记专业课笔记”）              |
|                    | tutor_id      | BIGINT                                   | 外键（关联 `tutor.id`，导师独创方法非空）         |
|                    | checkin_count | INT                                      | 总打卡人数（如1286）                                |
|                    | rating        | DECIMAL(2,1)                             | 评分（如4.9）                                       |
|                    | review_count  | INT                                      | 评价数（如328）                                     |
|                    | status        | TINYINT                                  | 状态（0-启用，1-下架）                              |
| `checkin_record` | id            | BIGINT                                   | 主键                                                |
|                    | user_id       | BIGINT                                   | 外键（关联 `user.id`）                            |
|                    | method_id     | BIGINT                                   | 外键（关联 `study_method.id`）                    |
|                    | checkin_type  | VARCHAR(20)                              | 打卡类型（正字打卡、计数打卡）                      |
|                    | progress      | INT                                      | 进度（如1-4遍）                                     |
|                    | note          | TEXT                                     | 打卡心得（可选）                                    |
|                    | checkin_time  | DATETIME                                 | 打卡时间                                            |
|                    | UNIQUE KEY    | (user_id, method_id, DATE(checkin_time)) | 单日同一方法仅可打卡1次                             |

## 四、导师与服务域（支撑导师页）

| 表名                    | 字段名              | 类型         | 备注（关联关系/核心功能）                        |
| ----------------------- | ------------------- | ------------ | ------------------------------------------------ |
| `tutor`               | id                  | BIGINT       | 主键                                             |
|                         | username            | VARCHAR(50)  | 导师名（如“王英语老师”）                       |
|                         | avatar              | VARCHAR(255) | 头像URL（或 emoji）                              |
|                         | type                | TINYINT      | 类型（0-普通导师，1-认证导师）                   |
|                         | domain              | VARCHAR(200) | 擅长领域（如“考研英语、四六级提分               |
|                         | education           | VARCHAR(200) | 教育背景（如“北京外国语大学英语语言文学硕士”） |
|                         | experience          | VARCHAR(200) | 上岸经历（如“考研英语一92分，雅思8.5分”）      |
|                         | work_experience     | TEXT         | 工作经历（如“新东方考研英语讲师8年”）          |
|                         | philosophy          | TEXT         | 指导理念                                         |
|                         | rating              | INT          | 好评率（如98）                                   |
|                         | student_count       | INT          | 指导人数（如126）                                |
|                         | success_rate        | INT          | 学员上岸率（如89）                               |
|                         | monthly_guide_count | INT          | 近30天指导人数（如18）                           |
| `tutor_service`       | id                  | BIGINT       | 主键                                             |
|                         | tutor_id            | BIGINT       | 外键（关联 `tutor.id`，一对多）                |
|                         | name                | VARCHAR(100) | 服务名（如“时间表点评”）                       |
|                         | price               | INT          | 价格（钻石，如68）                               |
|                         | description         | TEXT         | 服务描述（如“12小时内反馈，指出时间分配问题”） |
|                         | unit                | VARCHAR(20)  | 单位（如“/篇”，可空）                          |
| `tutor_review`        | id                  | BIGINT       | 主键                                             |
|                         | tutor_id            | BIGINT       | 外键（关联 `tutor.id`，一对多）                |
|                         | user_id             | BIGINT       | 外键（关联 `user.id`，评价用户）               |
|                         | reviewer_name       | VARCHAR(50)  | 评价者昵称（如“小夏（24考研上岸）”）           |
|                         | rating              | INT          | 评分（1-5星）                                    |
|                         | content             | TEXT         | 评价内容                                         |
|                         | attachment          | VARCHAR(200) | 附件描述（如“📅 附：优化后的英语学习时间表”）  |
|                         | create_time         | DATETIME     | 评价时间                                         |
| `tutor_service_order` | id                  | BIGINT       | 主键                                             |
|                         | user_id             | BIGINT       | 外键（关联 `user.id`）                         |
|                         | tutor_id            | BIGINT       | 外键（关联 `tutor.id`）                        |
|                         | service_id          | BIGINT       | 外键（关联 `tutor_service.id`）                |
|                         | amount              | INT          | 订单金额（钻石）                                 |
|                         | status              | TINYINT      | 状态（0-待服务，1-服务中，2-已完成，3-已取消）   |
|                         | create_time         | DATETIME     | 订单时间                                         |

## 五、成功案例域（支撑成功案例页）

| 表名             | 字段名       | 类型         | 备注（关联关系/核心功能）                         |
| ---------------- | ------------ | ------------ | ------------------------------------------------- |
| `success_case` | id           | BIGINT       | 主键                                              |
|                  | user_id      | BIGINT       | 外键（关联 `user.id`，案例作者）                |
|                  | title        | VARCHAR(200) | 案例标题（如“976小时高考逆袭200分上一本”）      |
|                  | icon         | VARCHAR(20)  | 图标（如“📚”）                                  |
|                  | duration     | VARCHAR(20)  | 投入时长（如“976h”）                            |
|                  | tags         | TEXT         | 标签（JSON格式，如["高考","失恋逆袭","日均13h"]） |
|                  | author_name  | VARCHAR(50)  | 上岸者名（如“小夏”）                            |
|                  | view_count   | INT          | 查看人数（如1286）                                |
|                  | is_hot       | TINYINT      | 是否热门（0-否，1-是）                            |
|                  | preview_days | INT          | 免费预览天数（如3）                               |
|                  | price        | VARCHAR(20)  | 查看价格（如“88钻石查看”）                      |
|                  | status       | TINYINT      | 状态（0-待审核，1-已发布，2-已下架）              |
|                  | create_time  | DATETIME     | 发布时间                                          |

## 六、动态与消息域（支撑动态广场、消息中心）

| 表名                   | 字段名           | 类型                                   | 备注（关联关系/核心功能）                                       |
| ---------------------- | ---------------- | -------------------------------------- | --------------------------------------------------------------- |
| `moment`             | id               | BIGINT                                 | 主键                                                            |
|                        | user_id          | BIGINT                                 | 外键（关联 `user.id`，发布者）                                |
|                        | type             | TINYINT                                | 类型（0-动态，1-干货，2-系统广告）                              |
|                        | title            | VARCHAR(200)                           | 标题（干货必填，动态可空）                                      |
|                        | content          | TEXT                                   | 内容                                                            |
|                        | image_url        | VARCHAR(255)                           | 图片URL（可空）                                                 |
|                        | tags             | TEXT                                   | 标签（JSON格式，如["#考研英语","#今日复盘"]）                   |
|                        | like_count       | INT                                    | 点赞数                                                          |
|                        | comment_count    | INT                                    | 评论数                                                          |
|                        | share_count      | INT                                    | 分享数                                                          |
|                        | is_top           | TINYINT                                | 是否置顶（广告专用，0-否，1-是）                                |
|                        | create_time      | DATETIME                               | 发布时间                                                        |
| `moment_attachment`  | id               | BIGINT                                 | 主键                                                            |
|                        | moment_id        | BIGINT                                 | 外键（关联 `moment.id`，一对多）                              |
|                        | type             | VARCHAR(20)                            | 附件类型（schedule-关联时间表，method-关联学习方法，file-文件） |
|                        | related_id       | BIGINT                                 | 关联ID（如时间表ID、方法ID）                                    |
|                        | name             | VARCHAR(100)                           | 附件名（如“英语时间表.xlsx”）                                 |
| `moment_interaction` | id               | BIGINT                                 | 主键                                                            |
|                        | user_id          | BIGINT                                 | 外键（关联 `user.id`）                                        |
|                        | moment_id        | BIGINT                                 | 外键（关联 `moment.id`）                                      |
|                        | interaction_type | TINYINT                                | 互动类型（0-点赞，1-收藏）                                      |
|                        | create_time      | DATETIME                               | 互动时间                                                        |
|                        | UNIQUE KEY       | (user_id, moment_id, interaction_type) | 避免重复互动                                                    |
| `message`            | id               | BIGINT                                 | 主键                                                            |
|                        | sender_id        | BIGINT                                 | 外键（关联 `user.id`，发送者，系统消息为0）                   |
|                        | receiver_id      | BIGINT                                 | 外键（关联 `user.id`，接收者）                                |
|                        | type             | TINYINT                                | 类型（0-导师反馈，1-私信，2-系统通知）                          |
|                        | content          | TEXT                                   | 消息内容                                                        |
|                        | is_unread        | TINYINT                                | 是否未读（0-已读，1-未读）                                      |
|                        | related_id       | BIGINT                                 | 关联ID（如导师ID、时间表ID，可空）                              |
|                        | create_time      | DATETIME                               | 发送时间                                                        |
| `message_reply`      | id               | BIGINT                                 | 主键                                                            |
|                        | message_id       | BIGINT                                 | 外键（关联 `message.id`，一对多）                             |
|                        | user_id          | BIGINT                                 | 外键（关联 `user.id`，回复者）                                |
|                        | content          | TEXT                                   | 回复内容                                                        |
|                        | create_time      | DATETIME                               | 回复时间                                                        |

## 七、AI与统计域（支撑AI对话、统计功能）

| 表名                   | 字段名             | 类型          | 备注（关联关系/核心功能）                                |
| ---------------------- | ------------------ | ------------- | -------------------------------------------------------- |
| `ai_chat_record`     | id                 | BIGINT        | 主键                                                     |
|                        | user_id            | BIGINT        | 外键（关联 `user.id`）                                 |
|                        | role               | VARCHAR(20)   | 角色（user-用户，ai-AI助手）                             |
|                        | content            | TEXT          | 消息内容                                                 |
|                        | is_analysis        | TINYINT       | 是否分析型回复（0-否，1-是）                             |
|                        | create_time        | DATETIME      | 消息时间                                                 |
| `ai_analysis_record` | id                 | BIGINT        | 主键                                                     |
|                        | user_id            | BIGINT        | 外键（关联 `user.id`）                                 |
|                        | analysis_tags      | TEXT          | 分析标签（JSON格式，如["复习不足","时间碎片化"]）        |
|                        | analysis_content   | TEXT          | 分析内容                                                 |
|                        | create_time        | DATETIME      | 分析时间                                                 |
|                        | expire_time        | DATETIME      | 过期时间（如24小时后过期，避免重复分析）                 |
| `ai_recommendation`  | id                 | BIGINT        | 主键                                                     |
|                        | user_id            | BIGINT        | 外键（关联 `user.id`）                                 |
|                        | rec_type           | VARCHAR(20)   | 推荐类型（method-学习方法，case-案例，tutor-导师）       |
|                        | related_id         | BIGINT        | 关联ID（方法ID/案例ID/导师ID）                           |
|                        | is_accepted        | TINYINT       | 是否采纳（0-未处理，1-采纳，2-拒绝）                     |
|                        | create_time        | DATETIME      | 推荐时间                                                 |
| `statistic_weekly`   | id                 | BIGINT        | 主键                                                     |
|                        | user_id            | BIGINT        | 外键（关联 `user.id`）                                 |
|                        | year_week          | VARCHAR(20)   | 年周（如“2025-38”，表示2025年第38周）                  |
|                        | total_study_hours  | DECIMAL(10,1) | 总学习时长（如8.5h）                                     |
|                        | high_freq_complete | VARCHAR(20)   | 高频任务完成（如“4/5”）                                |
|                        | overcome_complete  | VARCHAR(20)   | 待克服任务完成（如“1/2”）                              |
|                        | ai_accept_rate     | INT           | AI推荐采纳率（如75）                                     |
|                        | category_hours     | TEXT          | 各类型时长（JSON格式，如{"学习":8.5,"生活":5,"工作":4}） |
|                        | create_time        | DATETIME      | 统计生成时间（如每周一凌晨）                             |

## 八、徽章域（支撑个人主页徽章墙）

| 表名           | 字段名      | 类型                | 备注（关联关系/核心功能）             |
| -------------- | ----------- | ------------------- | ------------------------------------- |
| `badge`      | id          | BIGINT              | 主键                                  |
|                | name        | VARCHAR(50)         | 徽章名（如“坚持之星”）              |
|                | icon        | VARCHAR(20)         | 图标（如“🔥”）                      |
|                | description | VARCHAR(200)        | 描述（如“连续7天完成学习计划打卡”） |
|                | condition   | TEXT                | 解锁条件（如“连续7天打卡”）         |
|                | sort_order  | INT                 | 排序序号（用于徽章墙展示顺序）        |
| `user_badge` | id          | BIGINT              | 主键                                  |
|                | user_id     | BIGINT              | 外键（关联 `user.id`）              |
|                | badge_id    | BIGINT              | 外键（关联 `badge.id`）             |
|                | obtain_time | DATE                | 获得日期（未获得为NULL）              |
|                | UNIQUE KEY  | (user_id, badge_id) | 避免重复获得同一徽章                  |

## 表间核心关系总结

1. **一对多关系**（核心）：

   - user → task/subtask/time_slot/moment/message（一个用户多个任务/时段/动态/消息）
   - task → subtask（一个主任务多个子任务）
   - time_slot → mood_record（一个时段一条心情记录）
   - tutor → tutor_service/tutor_review（一个导师多个服务/评价）
2. **多对多关系**（通过中间表）：

   - user ↔ badge（通过user_badge表，一个用户多个徽章，一个徽章多个用户）
   - user ↔ tutor（通过user_relation表，一个用户关注多个导师，一个导师多个粉丝）

### 结尾交付物提议

要不要我帮你生成一份 **“核心表的SQL建表语句模板”**？包含主键、外键、索引定义（如user_id、method_id等常用查询字段的索引），你可直接复制到数据库工具中，再根据实际需求调整字段长度、默认值等细节。
